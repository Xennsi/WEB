# Чат-приложение на основе микросервисов с FastAPI, WebSocket и Docker

## Оглавление

1. [Описание проекта](#описание-проекта)
2. [Стек технологий](#стек-технологий)
3. [Архитектура приложения](#архитектура-приложения)
4. [Установка и запуск](#установка-и-запуск)
    - [Предварительные требования](#предварительные-требования)
    - [Настройка переменных окружения](#настройка-переменных-окружения)
    - [Запуск с помощью Docker Compose](#запуск-с-помощью-docker-compose)
5. [Использование приложения](#использование-приложения)
6. [Описание API](#описание-api)
7. [Структура базы данных](#структура-базы-данных)
8. [Скриншоты интерфейса](#скриншоты-интерфейса)
9. [Разработка и тестирование](#разработка-и-тестирование)
10. [Проблемы и пути их решения](#проблемы-и-пути-их-решения)


---

## Описание проекта

Это чат-приложение с веб-интерфейсом, построенное с использованием архитектуры микросервисов. Приложение поддерживает регистрацию и аутентификацию пользователей, создание чат-комнат, подключение к комнатам, обмен сообщениями в реальном времени через WebSocket и простую систему управления комнатами (поиск, создание, удаление). 

### Основные возможности:
- **Регистрация и аутентификация** с использованием JWT токенов.
- **Создание и управление чат-комнатами**.
- **Отправка и получение сообщений в реальном времени** с использованием WebSocket.
- **Минималистичный и адаптивный интерфейс** с поддержкой Jinja2 и HTML.

## Стек технологий

- **Backend**: Python, FastAPI, WebSocket
- **Frontend**: HTML, CSS, Jinja2, JavaScript
- **База данных**: PostgreSQL
- **Контейнеризация**: Docker, Docker Compose
- **Обратный прокси**: Nginx

## Архитектура приложения

Архитектура построена на микросервисах:
- **Микросервис `website`**: Управляет пользователями и чат-комнатами. Этот сервис предоставляет REST API для операций с пользователями и комнатами. Также он обслуживает HTML-страницы, созданные с помощью Jinja2.
- **Микросервис `chat`**: Обеспечивает функциональность чатов в реальном времени с использованием WebSocket. Этот сервис управляет подключениями и отправкой сообщений в определенные комнаты.
- **База данных PostgreSQL**: Хранит информацию о пользователях и чат-комнатах.
- **Nginx**: Работает как обратный прокси, разделяя запросы между сервисами `website` и `chat`.

## Установка и запуск

### Предварительные требования

- Установленный [Docker](https://www.docker.com/get-started).
- Установленный [Docker Compose](https://docs.docker.com/compose/install/).

### Настройка переменных окружения

Создайте файл `.env` в корневой директории проекта и добавьте следующие переменные:

```env
POSTGRES_USER=<ваш_пользователь>
POSTGRES_PASSWORD=<ваш_пароль>
POSTGRES_DB=<имя_базы_данных>
JWT_SECRET_KEY=<секретный_ключ_для_JWT>
ACCESS_TOKEN_EXPIRE_MINUTES=30
```

**Описание переменных:**
- `POSTGRES_USER`, `POSTGRES_PASSWORD`, `POSTGRES_DB`: Данные для подключения к базе данных PostgreSQL.
- `JWT_SECRET_KEY`: Секретный ключ для генерации JWT токенов.
- `ACCESS_TOKEN_EXPIRE_MINUTES`: Время жизни JWT токена в минутах.

### Запуск с помощью Docker Compose

1. Склонируйте репозиторий:
   ```bash
   git clone <URL репозитория>
   cd <название папки>
   ```

2. Запустите приложение с помощью Docker Compose:
   ```bash
   docker-compose up --build
   ```

3. Приложение будет доступно по адресу `http://localhost`.

Чтобы остановить контейнеры, используйте:
```bash
docker-compose down
```

## Использование приложения

### Регистрация и авторизация

1. Откройте `http://localhost` в браузере.
2. Зарегистрируйтесь с помощью email и пароля.
3. После регистрации вы сможете войти в систему, создавая и управляя чат-комнатами.

### Основные функции

- **Создание комнаты**: После входа вы сможете создать новую комнату.
- **Поиск комнат**: Используйте строку поиска для нахождения нужных комнат.
- **Подключение к комнате**: Выберите комнату для подключения. После подключения сообщения будут обновляться в режиме реального времени.

## Описание API

### API сервиса `website`

- **POST /register/**: Регистрация нового пользователя.
    - **Параметры**: `email`, `password`
    - **Ответ**: Перенаправление на страницу входа.

- **POST /token**: Получение JWT токена для авторизации.
    - **Параметры**: `username`, `password`
    - **Ответ**: JWT токен для доступа к защищенным маршрутам.

- **GET /chatrooms/**: Получение списка доступных комнат.
    - **Параметры**: `search` (опционально, для поиска по названию)
    - **Ответ**: HTML страница со списком комнат.

- **POST /chatrooms/create**: Создание новой комнаты.
    - **Параметры**: `name` (название комнаты)
    - **Ответ**: JSON с информацией о новой комнате.

- **DELETE /chatrooms/delete/{room_id}**: Удаление комнаты.
    - **Параметры**: `room_id`
    - **Ответ**: JSON с подтверждением удаления.

- **GET /chatrooms/chat/{chat_room_id}**: Подключение к определенной комнате.
    - **Параметры**: `chat_room_id`
    - **Ответ**: HTML страница комнаты с чатом.

### API сервиса `chat`

- **WebSocket /ws/{chat_room_id}**: Подключение к комнате чата через WebSocket.
    - **Параметры**: `chat_room_id`, JWT токен в заголовке запроса.
    - **Функционал**: Обеспечивает прием и отправку сообщений в комнате.

## Структура базы данных

Используется база данных PostgreSQL. Основные таблицы:

- **users**: Хранит информацию о пользователях (ID, email, зашифрованный пароль).
- **chatrooms**: Хранит данные о чат-комнатах (ID, название, ID владельца).
- **messages**: Хранит сообщения (ID, текст сообщения, ID комнаты, ID отправителя, временная метка).

### Миграции базы данных

Если база данных обновляется, используйте SQLAlchemy для автоматической миграции схемы.

## Скриншоты интерфейса

Примерные скриншоты для каждого из сценариев использования:

- **Экран регистрации**
- **Экран авторизации**
- **Главная страница с комнатами**
- **Чат-комната с сообщениями**

## Разработка и тестирование

### Разработка

Для разработки установите зависимости локально:

```bash
pip install -r requirements.txt
```

Запустите приложение FastAPI:

```bash
uvicorn app.main:app --reload
```

### Тестирование

Рекомендуется использовать `pytest` для тестирования:

1. Установите `pytest`:
   ```bash
   pip install pytest
   ```

2. Запустите тесты:
   ```bash
   pytest
   ```

## Проблемы и пути их решения

- **Ошибка подключения к базе данных**: Убедитесь, что база данных PostgreSQL доступна и данные для подключения правильные.
- **Ошибка авторизации**: Проверьте JWT токен и настройки секретного ключа.
- **Не отображаются сообщения**: Убедитесь, что WebSocket правильно подключен к сервису `chat`.

### 1. Клонирование репозитория

```bash
git clone https://github.com/Xennsi/WEB.git
cd WEB
<<<<<<< HEAD

=======
>>>>>>> d1d7e9b (Обновление: улучшены файлы шаблонов и main.py)
